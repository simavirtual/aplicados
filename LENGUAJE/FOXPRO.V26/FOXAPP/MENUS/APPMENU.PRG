*       *********************************************************
*       *                                                         
*       * 05/05/94             APPMENU.MPR              13:38:34  
*       *                                                         
*       *********************************************************
*       *                                                         
*       * Walter J. Kennamer                                      
*       *                                                         
*       * Copyright (c) 1994 Microsoft Corp.                      
*       * One Microsoft Way                                       
*       * Redmond, WA  98027                                      
*       *                                                         
*       * Description:                                            
*       * This program was automatically generated by GENMENU.    
*       *                                                         
*       *********************************************************


*       *********************************************************
*       *                                                         
*       *                        Setup Code                       
*       *                                                         
*       *********************************************************
*

SET SYSMENU AUTOMATIC
EXTERNAL PROCEDURE showpop, juststem, justfname, justpath, addbs, ;
   forceext, defaultext, justext

IF TYPE("SKIPVAR") <> "U"
   RELEASE m.skipvar
ENDIF
PUBLIC m.skipvar
m.skipvar = .F.
CLEAR MACRO


*       *********************************************************
*       *                                                         
*       *                      Menu Definition                    
*       *                                                         
*       *********************************************************
*

SET SYSMENU TO

SET SYSMENU AUTOMATIC

DEFINE PAD _qpr0t8our OF _MSYSMENU PROMPT "\<Archivo" COLOR SCHEME 3 ;
	KEY ALT+A, ""
DEFINE PAD _qpr0t8ouz OF _MSYSMENU PROMPT "\<Edici¢n" COLOR SCHEME 3 ;
	KEY ALT+E, ""
DEFINE PAD _qpr0t8ovb OF _MSYSMENU PROMPT "Ap\<licaci¢n" COLOR SCHEME 3 ;
	KEY ALT+L, ""
DEFINE PAD _qpr0t8ovl OF _MSYSMENU PROMPT "U\<tilidades" COLOR SCHEME 3 ;
	KEY ALT+T, ""
DEFINE PAD _qpr0t8ovs OF _MSYSMENU PROMPT "Ay\<uda" COLOR SCHEME 3 ;
	KEY ALT+U, ""
ON PAD _qpr0t8our OF _MSYSMENU ACTIVATE POPUP archivo
ON PAD _qpr0t8ouz OF _MSYSMENU ACTIVATE POPUP edici¢n
ON PAD _qpr0t8ovb OF _MSYSMENU ACTIVATE POPUP aplicaci¢n
ON PAD _qpr0t8ovl OF _MSYSMENU ACTIVATE POPUP utilidades
ON PAD _qpr0t8ovs OF _MSYSMENU ACTIVATE POPUP ayuda

DEFINE POPUP archivo MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFINE BAR _MFI_SETUP OF archivo PROMPT "\<Configurar impresi¢n"
DEFINE BAR 2 OF archivo PROMPT "\-"
DEFINE BAR 3 OF archivo PROMPT "\<Salir"
ON SELECTION BAR 3 OF archivo ;
	DO _qpr0t8ow9 ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")

DEFINE POPUP edici¢n MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFINE BAR _MED_CUT OF edici¢n PROMPT "Cor\<tar" ;
	KEY CTRL+X, "Ctrl+X"
DEFINE BAR _MED_COPY OF edici¢n PROMPT "\<Copiar" ;
	KEY CTRL+C, "Ctrl+C"
DEFINE BAR _MED_PASTE OF edici¢n PROMPT "\<Pegar" ;
	KEY CTRL+V, "Ctrl+V"
DEFINE BAR _MED_PSTLK OF edici¢n PROMPT "Pegado \<especial..."
DEFINE BAR _MED_CLEAR OF edici¢n PROMPT "Borr\<ar"
DEFINE BAR _MED_SP200 OF edici¢n PROMPT "\-"
DEFINE BAR _MED_INSOB OF edici¢n PROMPT "\<Insertar objeto..."
DEFINE BAR _MED_OBJ OF edici¢n PROMPT "\<Objeto"
DEFINE BAR _MED_LINK OF edici¢n PROMPT "Cambiar \<v¡nculo"
DEFINE BAR _MED_CVTST OF edici¢n PROMPT "Convertir a e\<st tico"
DEFINE BAR _med_sp300 OF edici¢n PROMPT "\-"
DEFINE BAR _MED_SLCTA OF edici¢n PROMPT "Se\<leccionar todo" ;
	KEY CTRL+A, "Ctrl+A"
DEFINE BAR _MED_SP300 OF edici¢n PROMPT "\-"
DEFINE BAR _MED_PREF OF edici¢n PROMPT "\<Preferencias..."

DEFINE POPUP aplicaci¢n MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFINE BAR 1 OF aplicaci¢n PROMPT "\<Principio" ;
	KEY F2, "F2" ;
	SKIP FOR skipvar or bof()
DEFINE BAR 2 OF aplicaci¢n PROMPT "\<Anterior" ;
	KEY F5, "F5" ;
	SKIP FOR skipvar or bof()
DEFINE BAR 3 OF aplicaci¢n PROMPT "\<Siguiente" ;
	KEY F4, "F4" ;
	SKIP FOR skipvar or eof()
DEFINE BAR 4 OF aplicaci¢n PROMPT "él\<timo" ;
	KEY F3, "F3" ;
	SKIP FOR skipvar or eof()
DEFINE BAR _MWI_ROTAT OF aplicaci¢n PROMPT "\<Recorrer" ;
	KEY CTRL+F1, "Ctrl+F1"
DEFINE BAR 6 OF aplicaci¢n PROMPT "\-"
DEFINE BAR 7 OF aplicaci¢n PROMPT "Agr\<egar registro" ;
	KEY CTRL+G, "Ctrl+G" ;
	SKIP FOR skipvar
DEFINE BAR 8 OF aplicaci¢n PROMPT "\<Copiar registro" ;
	SKIP FOR skipvar OR m.wiz_screen
DEFINE BAR 9 OF aplicaci¢n PROMPT "E\<liminar registro" ;
	KEY CTRL+E, "Ctrl+E" ;
	SKIP FOR skipvar
DEFINE BAR 10 OF aplicaci¢n PROMPT "\-"
DEFINE BAR 11 OF aplicaci¢n PROMPT "Encontrar" ;
	SKIP FOR skipvar
DEFINE BAR 12 OF aplicaci¢n PROMPT "\<Buscar..." ;
	KEY CTRL+B, "Ctrl+B" ;
	SKIP FOR skipvar
DEFINE BAR 13 OF aplicaci¢n PROMPT "\<Filtro..." ;
	KEY CTRL+F, "Ctrl+F" ;
	SKIP FOR skipvar
DEFINE BAR 14 OF aplicaci¢n PROMPT "\<Ordenar..." ;
	KEY CTRL+O, "Ctrl+O" ;
	SKIP FOR skipvar OR m.wiz_screen
DEFINE BAR 15 OF aplicaci¢n PROMPT "\-"
DEFINE BAR 16 OF aplicaci¢n PROMPT "L\<ista de selecci¢n" ;
	KEY CTRL+L, "Ctrl+L" ;
	SKIP FOR m.skipvar or m.nextdbf <= 2
DEFINE BAR 17 OF aplicaci¢n PROMPT "\-"
DEFINE BAR 18 OF aplicaci¢n PROMPT "Co\<nsulta..." ;
	KEY CTRL+N, "Ctrl+N" ;
	SKIP FOR skipvar or ('EXE' $ VERSION())
DEFINE BAR 19 OF aplicaci¢n PROMPT "Infor\<me..." ;
	KEY CTRL+I, "Ctrl+I" ;
	SKIP FOR skipvar
ON SELECTION BAR 1 OF aplicaci¢n ;
	DO _qpr0t8p41 ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 2 OF aplicaci¢n ;
	DO _qpr0t8p4j ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 3 OF aplicaci¢n ;
	DO _qpr0t8p52 ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 4 OF aplicaci¢n ;
	DO _qpr0t8p5m ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 7 OF aplicaci¢n ;
	DO _qpr0t8p6f ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 8 OF aplicaci¢n ;
	DO _qpr0t8p6z ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 9 OF aplicaci¢n ;
	DO _qpr0t8p7q ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 11 OF aplicaci¢n ;
	DO _qpr0t8p8i ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 12 OF aplicaci¢n ;
	DO _qpr0t8p94 ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 13 OF aplicaci¢n ;
	DO _qpr0t8p9o ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 14 OF aplicaci¢n ;
	DO _qpr0t8pa9 ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 16 OF aplicaci¢n DO showpop WITH ALIAS(),VARREAD()
ON SELECTION BAR 18 OF aplicaci¢n ;
	DO _qpr0t8pb5 ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 19 OF aplicaci¢n ;
	DO _qpr0t8pbp ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")

DEFINE POPUP utilidades MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFINE BAR 1 OF utilidades PROMPT "\<Actualizar pantalla" ;
	SKIP FOR skipvar
DEFINE BAR 2 OF utilidades PROMPT "\<Construir ¡ndice" ;
	SKIP FOR skipvar
DEFINE BAR 3 OF utilidades PROMPT "\<Empaquetar" ;
	SKIP FOR skipvar
ON SELECTION BAR 1 OF utilidades ;
	DO _qpr0t8pd3 ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 2 OF utilidades ;
	DO _qpr0t8pdm ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")
ON SELECTION BAR 3 OF utilidades ;
	DO _qpr0t8pe6 ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")

DEFINE POPUP ayuda MARGIN RELATIVE SHADOW COLOR SCHEME 4
DEFINE BAR _MST_HELP OF ayuda PROMPT "Ay\<uda..." ;
	KEY F1, "F1"
DEFINE BAR 2 OF ayuda PROMPT "\-"
DEFINE BAR _MST_MACRO OF ayuda PROMPT "\<Macros"
DEFINE BAR _MST_CALCU OF ayuda PROMPT "\<Calculadora"
DEFINE BAR _MST_DIARY OF ayuda PROMPT "Ca\<lendario/Agenda"
DEFINE BAR _MST_PUZZL OF ayuda PROMPT "Pu\<zzle"
DEFINE BAR 7 OF ayuda PROMPT "\-"
DEFINE BAR 8 OF ayuda PROMPT "\<Acerca de..."
ON SELECTION BAR 8 OF ayuda ;
	DO _qpr0t8pen ;
	IN LOCFILE("FOXAPP\MENUS\APPMENU" ,"MPX;MPR|FXP;PRG" ,"Where is APPMENU?")


*       *********************************************************
*       *                                                         
*       * _QPR0T8OW9  ON SELECTION BAR 3 OF POPUP archivo         
*       *                                                         
*       * Procedure Origin:                                       
*       *                                                         
*       * From Menu:  APPMENU.MPR,            Record:    8        
*       * Called By:  ON SELECTION BAR 3 OF POPUP archivo         
*       * Prompt:     Salir                                       
*       * Snippet:    1                                           
*       *                                                         
*       *********************************************************
*
PROCEDURE _qpr0t8ow9
* Select the main database
dbfstem = makealias(juststem(m.dbfname))
SELECT (dbfstem)
=actwin(woutput())

bailout = .T.
CLEAR READ






*       *********************************************************
*       *                                                         
*       * _QPR0T8P41  ON SELECTION BAR 1 OF POPUP aplicaci¢n      
*       *                                                         
*       * Procedure Origin:                                       
*       *                                                         
*       * From Menu:  APPMENU.MPR,            Record:   27        
*       * Called By:  ON SELECTION BAR 1 OF POPUP aplicaci¢n      
*       * Prompt:     Principio                                   
*       * Snippet:    2                                           
*       *                                                         
*       *********************************************************
*
PROCEDURE _qpr0t8p41
GOTO TOP
IF !m.wiz_screen
   ACTIVATE WINDOW appctrl
ENDIF
IF m.wiz_screen
   SCATTER MEMVAR MEMO
ENDIF
WAIT WINDOW "Principio de archivo" NOWAIT
SHOW GETS



*       *********************************************************
*       *                                                         
*       * _QPR0T8P4J  ON SELECTION BAR 2 OF POPUP aplicaci¢n      
*       *                                                         
*       * Procedure Origin:                                       
*       *                                                         
*       * From Menu:  APPMENU.MPR,            Record:   28        
*       * Called By:  ON SELECTION BAR 2 OF POPUP aplicaci¢n      
*       * Prompt:     Anterior                                    
*       * Snippet:    3                                           
*       *                                                         
*       *********************************************************
*
PROCEDURE _qpr0t8p4j
SKIP -1
IF BOF()
   WAIT WINDOW "Principio de archivo" NOWAIT
   GOTO TOP
ENDIF
IF m.wiz_screen
   SCATTER MEMVAR MEMO
ENDIF
SHOW GETS



*       *********************************************************
*       *                                                         
*       * _QPR0T8P52  ON SELECTION BAR 3 OF POPUP aplicaci¢n      
*       *                                                         
*       * Procedure Origin:                                       
*       *                                                         
*       * From Menu:  APPMENU.MPR,            Record:   29        
*       * Called By:  ON SELECTION BAR 3 OF POPUP aplicaci¢n      
*       * Prompt:     Siguiente                                   
*       * Snippet:    4                                           
*       *                                                         
*       *********************************************************
*
PROCEDURE _qpr0t8p52
SKIP
IF EOF()
   WAIT WINDOW "Fin de archivo" NOWAIT
   GOTO BOTTOM
ENDIF
IF m.wiz_screen
   SCATTER MEMVAR MEMO
ENDIF
SHOW GETS



*       *********************************************************
*       *                                                         
*       * _QPR0T8P5M  ON SELECTION BAR 4 OF POPUP aplicaci¢n      
*       *                                                         
*       * Procedure Origin:                                       
*       *                                                         
*       * From Menu:  APPMENU.MPR,            Record:   30        
*       * Called By:  ON SELECTION BAR 4 OF POPUP aplicaci¢n      
*       * Prompt:     éltimo                                      
*       * Snippet:    5                                           
*       *                                                         
*       *********************************************************
*
PROCEDURE _qpr0t8p5m
GOTO BOTTOM
IF m.wiz_screen
   SCATTER MEMVAR MEMO
ENDIF
WAIT WINDOW "Fin de archivo" NOWAIT
SHOW GETS



*       *********************************************************
*       *                                                         
*       * _QPR0T8P6F  ON SELECTION BAR 7 OF POPUP aplicaci¢n      
*       *                                                         
*       * Procedure Origin:                                       
*       *                                                         
*       * From Menu:  APPMENU.MPR,            Record:   33        
*       * Called By:  ON SELECTION BAR 7 OF POPUP aplicaci¢n      
*       * Prompt:     Agregar registro                            
*       * Snippet:    6                                           
*       *                                                         
*       *********************************************************
*
PROCEDURE _qpr0t8p6f
#DEFINE C_NOPARENT		"No es posible agregar un registro subordinado si no hay uno principal."

IF m.wiz_screen
  do ("btn_val") WITH "ADD"
ELSE
  * Add a record to the current database. Called from "Add Record" menu option, if
  * this is not a wizard screen.
  *-------------------------------------------------------------------------------

  EXTERNAL ARRAY dbflist

  PRIVATE allblank, i, fldname, sname, c_rec

  IF (m.nextdbf <= 2) OR (ALIAS() = dbflist[1,m.cstemnum])
     * Appending into main database

     * Always allow this if there are no records; otherwise check for existing
     * blank records.
     allblank = .F.
     IF RECCOUNT() > 0
        sname = makealias(juststem(m.dbfname))
        SELECT (sname)
        GOTO TOP

        DO WHILE DELETED() AND !EOF()
           SKIP
        ENDDO
        IF EOF()   && all records appear to be deleted
           GOTO TOP
        ENDIF

        =actwin(m.win_name)

        m.allblank = .T.
        FOR i = 1 TO FCOUNT()
           m.fldname = FIELD(i)
           IF !EMPTY(&fldname)
              m.allblank = .F.
           ENDIF
        ENDFOR

        * Make sure all records aren't deleted
        IF m.allblank
           IF RECCOUNT() < 10   && just a rule of thumb
              COUNT FOR !DELETED() TO notdel
              GOTO TOP
              IF m.notdel = 0
                 m.allblank = .F.
              ENDIF
           ENDIF
        ENDIF
     ENDIF

     IF !m.allblank
        APPEND BLANK
        SHOW GETS
     ENDIF

     _CUROBJ = 1

     IF m.wiz_screen
        SCATTER MEMVAR MEMO
        SHOW GETS
     ENDIF

     =actwin(m.win_name)

  ELSE   && appending record into a child browse
     * Fill in the key fields.  First find the dbflist record for this
     * database.
     i = 1
     got_it = .F.
     DO WHILE i <= m.numareas AND !got_it
        IF UPPER(dbflist[i,m.cstemnum]) == ALIAS()
           got_it = .T.
        ELSE
           i = i + 1
        ENDIF
     ENDDO
     * If we found the current database, figure out what the parent database
     * is and make sure that the parent is not at EOF().
     IF !EOF(dbflist[m.i,m.pdbfnum])
  	   * Also determine what its key field is and make it default
  	   * to the corresponding value in the parent database.  For
	   * example, if the current database is an invoice file, make the
	   * customer number default to the customer number of the current
	   * record in the customer file.
	   APPEND BLANK
	   IF got_it
	      * dbflist[m.i,m.cfldnum] looks like "DETAIL.INO"
	      childfld  = dbflist[m.i,m.cfldnum]
	      parentfld = dbflist[m.i,m.pfldnum]

	      * Replace the key field into the newly appended record
	      REPLACE &childfld WITH &parentfld
	   ENDIF
  	 ELSE
	   WAIT WINDOW C_NOPARENT
	 ENDIF
	 SHOW WINDOW (ALIAS()) REFRESH
  ENDIF
ENDIF





*       *********************************************************
*       *                                                         
*       * _QPR0T8P6Z  ON SELECTION BAR 8 OF POPUP aplicaci¢n      
*       *                                                         
*       * Procedure Origin:                                       
*       *                                                         
*       * From Menu:  APPMENU.MPR,            Record:   34        
*       * Called By:  ON SELECTION BAR 8 OF POPUP aplicaci¢n      
*       * Prompt:     Copiar registro                             
*       * Snippet:    7                                           
*       *                                                         
*       *********************************************************
*
PROCEDURE _qpr0t8p6z
SCATTER MEMVAR
APPEND BLANK
GATHER MEMVAR
IF TYPE("DBFLIST") = "U" OR ALIAS() == UPPER(dbflist[1,m.cstemnum])
   SHOW GETS
   =actwin(m.win_name)   && activate user window
ENDIF
SHOW WINDOW (ALIAS()) REFRESH


*       *********************************************************
*       *                                                         
*       * _QPR0T8P7Q  ON SELECTION BAR 9 OF POPUP aplicaci¢n      
*       *                                                         
*       * Procedure Origin:                                       
*       *                                                         
*       * From Menu:  APPMENU.MPR,            Record:   35        
*       * Called By:  ON SELECTION BAR 9 OF POPUP aplicaci¢n      
*       * Prompt:     Eliminar registro                           
*       * Snippet:    8                                           
*       *                                                         
*       *********************************************************
*
PROCEDURE _qpr0t8p7q
* Delete this record (and any children for which the cascading
* delete option is set) from the current database.

PRIVATE m.delrec, m.wasdeleted
m.wasdeleted = .F.
IF RECCOUNT() > 0
  IF m.wiz_screen
    m.delrec = recno()
    DO ("btn_val") WITH "DELETE"
    m.wasdeleted = RECNO() <> m.delrec		&& Wizard code deletes record and moves record
    										&& pointer. Use this to detect deletion (user
    										&& could have Canceled). In FoxApp, we want to
    										&& call procedure Cascade before the deletion,
    										&& so recall and delete again afterward.
    GO m.delrec
    RECALL
  ELSE
     WAIT WINDOW "Eliminando. Espere, por favor." NOWAIT
     m.wasdeleted = .t.
  ENDIF

  IF m.wasdeleted
     * Perform any necessary cascading deletes
     IF m.nextdbf > 1
        DO Cascade WITH ALIAS(), "DELETE"
     ENDIF

     DELETE

     * Moving off the deleted record if we are in the main screen
     IF TYPE("DBFLIST") = "U" OR ALIAS() = dbflist[1,m.cstemnum]
        IF !EOF()
           SKIP
        ENDIF
        IF EOF()
           GOTO TOP
        ENDIF
        IF m.wiz_screen
           SCATTER MEMVAR MEMO
        ENDIF
        SHOW GETS
     ELSE
        SHOW WINDOW (ALIAS()) REFRESH
     ENDIF

     WAIT CLEAR
  ENDIF
ENDIF



*       *********************************************************
*       *                                                         
*       * _QPR0T8P8I  ON SELECTION BAR 11 OF POPUP aplicaci¢n     
*       *                                                         
*       * Procedure Origin:                                       
*       *                                                         
*       * From Menu:  APPMENU.MPR,            Record:   37        
*       * Called By:  ON SELECTION BAR 11 OF POPUP aplicaci¢n     
*       * Prompt:     Encontrar                                   
*       * Snippet:    9                                           
*       *                                                         
*       *********************************************************
*
PROCEDURE _qpr0t8p8i
m.skipvar = .T.
dbfstem = makealias(juststem(m.dbfname))
SELECT (dbfstem)
IF m.wiz_screen
  DO ("btn_val") WITH "LOCATE"
ELSE
  DEFINE WINDOW FA_loc FROM 1,1 TO 20,40;
	SYSTEM GROW CLOSE ZOOM FLOAT
  MOVE WINDOW FA_loc CENTER
  ON KEY LABEL enter KEYBOARD(CHR(23))
  BROWSE WINDOW FA_loc NOEDIT NODELETE NOAPPEND ;
	NOMENU TITLE "Encontrar registro" COLOR SCHEME 10
  ON KEY LABEL enter
  RELEASE WINDOW FA_loc
  SHOW MENU _msysmenu
  =actwin(woutput())
ENDIF
m.skipvar = .F.
IF m.wiz_screen
   SCATTER MEMVAR MEMO
ENDIF

SHOW GETS



*       *********************************************************
*       *                                                         
*       * _QPR0T8P94  ON SELECTION BAR 12 OF POPUP aplicaci¢n     
*       *                                                         
*       * Procedure Origin:                                       
*       *                                                         
*       * From Menu:  APPMENU.MPR,            Record:   38        
*       * Called By:  ON SELECTION BAR 12 OF POPUP aplicaci¢n     
*       * Prompt:     Buscar...                                   
*       * Snippet:    10                                          
*       *                                                         
*       *********************************************************
*
PROCEDURE _qpr0t8p94
m.dbfstem = makealias(juststem(m.dbfname))
SELECT (m.dbfstem)
IF !m.regen
   m.mname = 'appsrch.prg'
ELSE
   m.mname = 'appsrch.spr'
ENDIF
DO (m.mname)
IF m.wiz_screen
   SCATTER MEMVAR MEMO
ENDIF
SHOW GETS



*       *********************************************************
*       *                                                         
*       * _QPR0T8P9O  ON SELECTION BAR 13 OF POPUP aplicaci¢n     
*       *                                                         
*       * Procedure Origin:                                       
*       *                                                         
*       * From Menu:  APPMENU.MPR,            Record:   39        
*       * Called By:  ON SELECTION BAR 13 OF POPUP aplicaci¢n     
*       * Prompt:     Filtro...                                   
*       * Snippet:    11                                          
*       *                                                         
*       *********************************************************
*
PROCEDURE _qpr0t8p9o
m.orig_rec = RECNO()
GETEXPR 'Expresi¢n de filtro' TO m.filt_expr TYPE 'L' DEFAULT m.filt_expr
IF !EMPTY(m.filt_expr)
   SET FILTER TO &filt_expr
   GOTO TOP
   IF EOF()
      WAIT WINDOW "Ning£n registro coincide con el filtro" NOWAIT
      SET FILTER TO
      IF m.orig_rec <= RECCOUNT()
         GOTO m.orig_rec
      ENDIF
   ENDIF
ELSE
   SET FILTER TO
ENDIF
IF m.wiz_screen
   SCATTER MEMVAR MEMO
ENDIF

SHOW GETS



*       *********************************************************
*       *                                                         
*       * _QPR0T8PA9  ON SELECTION BAR 14 OF POPUP aplicaci¢n     
*       *                                                         
*       * Procedure Origin:                                       
*       *                                                         
*       * From Menu:  APPMENU.MPR,            Record:   40        
*       * Called By:  ON SELECTION BAR 14 OF POPUP aplicaci¢n     
*       * Prompt:     Ordenar...                                  
*       * Snippet:    12                                          
*       *                                                         
*       *********************************************************
*
PROCEDURE _qpr0t8pa9
m.dbfstem = makealias(juststem(m.dbfname))
SELECT (m.dbfstem)
IF !EMPTY(CDX(1))
   IF !m.regen
      m.mname = 'getorder.prg'
   ELSE
      m.mname = 'getorder.spr'
   ENDIF
   DO (m.mname)
   IF m.wiz_screen
      SCATTER MEMVAR MEMO
   ENDIF
   SHOW GETS
ELSE
   WAIT WINDOW "No se encontraron ¡ndices"
ENDIF



*       *********************************************************
*       *                                                         
*       * _QPR0T8PB5  ON SELECTION BAR 18 OF POPUP aplicaci¢n     
*       *                                                         
*       * Procedure Origin:                                       
*       *                                                         
*       * From Menu:  APPMENU.MPR,            Record:   44        
*       * Called By:  ON SELECTION BAR 18 OF POPUP aplicaci¢n     
*       * Prompt:     Consulta...                                 
*       * Snippet:    13                                          
*       *                                                         
*       *********************************************************
*
PROCEDURE _qpr0t8pb5
PRIVATE gen_name, i, qname, pname, win_name

CREATE VIEW qprview

* Select the main database
m.dbfstem = makealias(juststem(m.dbfname))
SELECT (m.dbfstem)

m.skipvar = .T.
m.gen_name = .F.

* Default query name is the database name with a QPR extension.
m.qname = addbs(m.qprpath) + forceext(justfname(m.dbfname),'QPR')

* If there are multiple databases in this app, create a query template
* so that the user doesn't have to enter all the relations again.
IF m.nextdbf > 2 AND TYPE("dbflist") <> "U"
   * Create a blank query file to pass the databases and relations
   * along to RQBE

   * Try to come up with a reasonable-sounding unique name for the query,
   * if the default name is already taken.
   m.i = 0
   DO WHILE FILE(m.qname) AND i < 100
      m.qname = ALLTRIM(LEFT(juststem(m.qname),6)) + STR(m.i,2)
      m.qname = CHRTRAN(m.qname,' ','0')
      m.qname = forceext(m.qname,'QPR')
      m.qname = addbs(m.qprpath) + m.qname
      m.i = m.i + 1
   ENDDO

   * Prompt the user for the query name and allow changes.
   * Change to the directory the user wants to use so that the
   * PUTFILE directory defaults are right.
   m.in_dir = SET('DEFAULT')+CURDIR()
   SET DEFAULT TO (qprpath)
   m.qname = PUTFILE('Nombre de consulta',m.qname,'QPR','Aceptar')
   SET DEFAULT TO (m.in_dir)

   IF EMPTY(m.qname)   && user changed his mind.
      m.skipvar = .F.
      RETURN
   ELSE
      * Use this path for future queries
      m.qprpath = justpath(m.qname)
   ENDIF

   * Create the query template file
   SET TEXTMERGE TO (m.qname)
   SET TEXTMERGE ON
   SET CONSOLE OFF

   m.gen_name = .T.     && note that this is a generated file

   \SELECT * ;
   \ FROM <<dbflist[1,m.cstemnum]>>
   FOR m.i = 2 TO m.nextdbf - 1
      \\, <<dbflist[m.i,m.cstemnum]>>
   ENDFOR
   \\ ;
   \ WHERE ;
   FOR m.i = 2 TO m.nextdbf - 1
      IF m.i > 2
         \   AND
      ELSE
         \
      ENDIF
      \\   <<dbflist[m.i,m.cfldnum]>> = <<dbflist[m.i,m.pfldnum]>> ;
   ENDFOR
   \INTO CURSOR FoxApp
   \BROWSE NOMODIFY

   SET CONSOLE ON
   SET TEXTMERGE OFF
   SET TEXTMERGE TO
ELSE
   * Prompt the user for the query name
   m.qname = PUTFILE('Nombre de consulta',m.qname,'QPR','Aceptar')
ENDIF

IF !EMPTY(m.qname)
   m.win_name = WOUTPUT()
   ACTIVATE SCREEN
   IF FILE(m.qname)
      MODIFY QUERY (m.qname)
   ELSE
      CREATE QUERY (m.qname)
   ENDIF
   CLEAR
   IF !EMPTY(m.win_name)
      ACTIVATE WINDOW (m.win_name)
   ENDIF
ELSE
   * Delete this file if it was a generated file and the
   * user cancelled the query.
   IF m.gen_name AND FILE(m.qname)
      DELETE FILE m.qname
   ENDIF
ENDIF
IF EMPTY(opendbf(m.dbfname))
   m.dbfname = LOCFILE(m.dbfname,'DBF','Por favor, localice la tabla')
ENDIF
m.skipvar = .F.

IF FILE('qprview.vue')
   SET VIEW TO qprview
ENDIF
KEYBOARD CHR(27)   && force screen refresh



*       *********************************************************
*       *                                                         
*       * _QPR0T8PBP  ON SELECTION BAR 19 OF POPUP aplicaci¢n     
*       *                                                         
*       * Procedure Origin:                                       
*       *                                                         
*       * From Menu:  APPMENU.MPR,            Record:   45        
*       * Called By:  ON SELECTION BAR 19 OF POPUP aplicaci¢n     
*       * Prompt:     Informe...                                  
*       * Snippet:    14                                          
*       *                                                         
*       *********************************************************
*
PROCEDURE _qpr0t8pbp
IF !m.regen
   m.mname = 'prtopts.prg'
ELSE
   m.mname = 'prtopts.spr'
ENDIF
DO (m.mname)



*       *********************************************************
*       *                                                         
*       * _QPR0T8PD3  ON SELECTION BAR 1 OF POPUP utilidades      
*       *                                                         
*       * Procedure Origin:                                       
*       *                                                         
*       * From Menu:  APPMENU.MPR,            Record:   48        
*       * Called By:  ON SELECTION BAR 1 OF POPUP utilidades      
*       * Prompt:     Actualizar pantalla                         
*       * Snippet:    15                                          
*       *                                                         
*       *********************************************************
*
PROCEDURE _qpr0t8pd3
=actwin(m.win_name)   && activate user window
KEYBOARD CHR(27)



*       *********************************************************
*       *                                                         
*       * _QPR0T8PDM  ON SELECTION BAR 2 OF POPUP utilidades      
*       *                                                         
*       * Procedure Origin:                                       
*       *                                                         
*       * From Menu:  APPMENU.MPR,            Record:   49        
*       * Called By:  ON SELECTION BAR 2 OF POPUP utilidades      
*       * Prompt:     Construir ¡ndice                            
*       * Snippet:    16                                          
*       *                                                         
*       *********************************************************
*
PROCEDURE _qpr0t8pdm
DO invert WITH ALIAS()
SET ORDER TO 1
GOTO TOP
_CUROBJ = 1
WAIT WINDOW "Reindexado completo" NOWAIT
SHOW GETS




*       *********************************************************
*       *                                                         
*       * _QPR0T8PE6  ON SELECTION BAR 3 OF POPUP utilidades      
*       *                                                         
*       * Procedure Origin:                                       
*       *                                                         
*       * From Menu:  APPMENU.MPR,            Record:   50        
*       * Called By:  ON SELECTION BAR 3 OF POPUP utilidades      
*       * Prompt:     Empaquetar                                  
*       * Snippet:    17                                          
*       *                                                         
*       *********************************************************
*
PROCEDURE _qpr0t8pe6
PACK   && also reindexes the file
SET ORDER TO 1
GOTO TOP
IF RECCOUNT() = 0
   APPEND BLANK
ENDIF
WAIT WINDOW "Empaquetado completo" NOWAIT
KEYBOARD CHR(27)    && causes screen refresh and restores browses
SHOW GETS




*       *********************************************************
*       *                                                         
*       * _QPR0T8PEN  ON SELECTION BAR 8 OF POPUP ayuda           
*       *                                                         
*       * Procedure Origin:                                       
*       *                                                         
*       * From Menu:  APPMENU.MPR,            Record:   61        
*       * Called By:  ON SELECTION BAR 8 OF POPUP ayuda           
*       * Prompt:     Acerca de...                                
*       * Snippet:    18                                          
*       *                                                         
*       *********************************************************
*
PROCEDURE _qpr0t8pen
IF !regen
   mname = 'appabout.prg'
ELSE
   mname = 'appabout.spr'
ENDIF
DO (mname)

