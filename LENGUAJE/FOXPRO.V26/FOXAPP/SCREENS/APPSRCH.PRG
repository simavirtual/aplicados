*       *********************************************************
*       *                                                         
*       * 05/05/94             APPSRCH.SPR               13:57:41 
*       *                                                         
*       *********************************************************
*       *                                                         
*       * Walter J. Kennamer                                      
*       *                                                         
*       * Copyright (c) 1994 Microsoft Corp.                      
*       * One Microsoft Way                                       
*       * Redmond, WA  98027                                      
*       *                                                         
*       * Description:                                            
*       * This program was automatically generated by GENSCRN.    
*       *                                                         
*       *********************************************************

DO CASE
CASE _DOS OR _UNIX      && no UNIX records in screen

	
	#REGION 0
	REGIONAL m.currarea, m.talkstat, m.compstat
	
	IF SET("TALK") = "ON"
		SET TALK OFF
		m.talkstat = "ON"
	ELSE
		m.talkstat = "OFF"
	ENDIF
	m.compstat = SET("COMPATIBLE")
	SET COMPATIBLE FOXPLUS
	
	*       *********************************************************
	*       *                                                         
	*       *                MS-DOS Window definitions                
	*       *                                                         
	*       *********************************************************
	*
	
	IF NOT WEXIST("_qpr0tx9hs")
		DEFINE WINDOW _qpr0tx9hs ;
			FROM INT((SROW()-7)/2),INT((SCOL()-59)/2) ;
			TO INT((SROW()-7)/2)+6,INT((SCOL()-59)/2)+58 ;
			TITLE " Buscar: " ;
			FLOAT ;
			NOCLOSE ;
			SHADOW ;
			NOMINIMIZE ;
			DOUBLE ;
			COLOR SCHEME 5
	ENDIF
	
	
	*       *********************************************************
	*       *                                                         
	*       *          APPSRCH/MS-DOS Setup Code - SECTION 2          
	*       *                                                         
	*       *********************************************************
	*
	
	#REGION 1
	IF TYPE("srchterm") $ "UL" OR EMPTY(m.srchterm)
	   m.srchterm = SPACE(60)
	ENDIF
	m.oksrch = 1
	m.fldnum = 0
	
	DIMENSION fldarry(10,4)   && default dimensions.  AFIELDS will reset if necessary.
	m.fldcnt = AFIELDS(fldarry)
	m.startord = ORDER()
	m.startalias = ALIAS()
	
	m.curord = ORDER()
	IF EMPTY(m.curord)
	   SET ORDER TO 1
	   m.curord = ORDER()
	ENDIF
	
	FOR i = 1 TO FCOUNT()
	   IF FIELDS(i) == m.curord
	      m.fldnum = i
	   ENDIF
	ENDFOR
	
	IF m.fldnum > 0
	   m.fldname = FIELDS(m.fldnum)
	ELSE
	   SET ORDER TO 1
	   m.fldnum  = 1
	   m.fldname = FIELDS(1)
	ENDIF
	
	skipvar = .T.
	
	curs_stat = (UPPER(SET("CURSOR")) = "ON")
	SET CURSOR ON
	
	
	*       *********************************************************
	*       *                                                         
	*       *              APPSRCH/MS-DOS Screen Layout               
	*       *                                                         
	*       *********************************************************
	*
	
	#REGION 1
	IF WVISIBLE("_qpr0tx9hs")
		ACTIVATE WINDOW _qpr0tx9hs SAME
	ELSE
		ACTIVATE WINDOW _qpr0tx9hs NOSHOW
	ENDIF
	@ 1,16 GET m.srchterm ;
		SIZE 1,26 ;
		DEFAULT " " ;
		PICTURE "@3S60" ;
		WHEN _qpr0txajv()
	@ 2,15 GET fldnum ;
		PICTURE "@^" ;
		FROM fldarry ;
		SIZE 3,27 ;
		DEFAULT 1 ;
		VALID _qpr0txamv() ;
		COLOR SCHEME 5, 6
	@ 1,45 GET oksrch ;
		PICTURE "@*VN \!Aceptar;\?Cancelar" ;
		SIZE 1,10,1 ;
		DEFAULT 1 ;
		VALID _qpr0txaqr()
	@ 1,7 SAY "Buscar:" ;
		SIZE 1,7, 0 ;
		COLOR N+/W    
	@ 3,2 SAY "En el campo:" ;
		SIZE 1,12, 0
	
	IF NOT WVISIBLE("_qpr0tx9hs")
		ACTIVATE WINDOW _qpr0tx9hs
	ENDIF
	
	
	*       *********************************************************
	*       *                                                         
	*       *     MS-DOSREAD contains clauses from SCREEN appsrch     
	*       *                                                         
	*       *********************************************************
	*
	
	READ CYCLE ;
		ACTIVATE _qpr0txb41() ;
		DEACTIVATE _qpr0txb45() ;
		MODAL
	
	RELEASE WINDOW _qpr0tx9hs
	
	#REGION 0
	IF m.talkstat = "ON"
		SET TALK ON
	ENDIF
	IF m.compstat = "ON"
		SET COMPATIBLE ON
	ENDIF
	
	
	*       *********************************************************
	*       *                                                         
	*       *               APPSRCH/MS-DOS Cleanup Code               
	*       *                                                         
	*       *********************************************************
	*
	
	#REGION 1
	IF m.curs_stat
	   SET CURSOR ON
	ELSE
	   SET CURSOR OFF
	ENDIF
	m.skipvar = .F.
	

CASE _MAC

	
	#REGION 0
	REGIONAL m.currarea, m.talkstat, m.compstat
	
	IF SET("TALK") = "ON"
		SET TALK OFF
		m.talkstat = "ON"
	ELSE
		m.talkstat = "OFF"
	ENDIF
	m.compstat = SET("COMPATIBLE")
	SET COMPATIBLE FOXPLUS
	
	m.rborder = SET("READBORDER")
	SET READBORDER ON
	
	*       *********************************************************
	*       *                                                         
	*       *              Macintosh Window definitions               
	*       *                                                         
	*       *********************************************************
	*
	
	IF NOT WEXIST("_qpr0txbfy")
		DEFINE WINDOW _qpr0txbfy ;
			AT  0.000, 0.000  ;
			SIZE 5.750,56.500 ;
			TITLE " Search for: " ;
			FONT "Geneva", 10 ;
			FLOAT ;
			NOCLOSE ;
			SHADOW ;
			DOUBLE
		MOVE WINDOW _qpr0txbfy CENTER
	ENDIF
	
	
	*       *********************************************************
	*       *                                                         
	*       *        APPSRCH/Macintosh Setup Code - SECTION 2         
	*       *                                                         
	*       *********************************************************
	*
	
	#REGION 1
	IF TYPE("srchterm") $ "UL" OR EMPTY(m.srchterm)
	   m.srchterm = SPACE(60)
	ENDIF
	m.oksrch = 1
	m.fldnum = 0
	
	DIMENSION fldarry(10,4)   && default dimensions.  AFIELDS will reset if necessary.
	m.fldcnt = AFIELDS(fldarry)
	m.startord = ORDER()
	m.startalias = ALIAS()
	
	m.curord = ORDER()
	IF EMPTY(m.curord)
	   SET ORDER TO 1
	   m.curord = ORDER()
	ENDIF
	
	FOR i = 1 TO FCOUNT()
	   IF FIELDS(i) == m.curord
	      m.fldnum = i
	   ENDIF
	ENDFOR
	
	IF m.fldnum > 0
	   m.fldname = FIELDS(m.fldnum)
	ELSE
	   SET ORDER TO 1
	   m.fldnum  = 1
	   m.fldname = FIELDS(1)
	ENDIF
	
	skipvar = .T.
	
	curs_stat = (UPPER(SET("CURSOR")) = "ON")
	SET CURSOR ON
	
	
	*       *********************************************************
	*       *                                                         
	*       *             APPSRCH/Macintosh Screen Layout             
	*       *                                                         
	*       *********************************************************
	*
	
	#REGION 1
	IF WVISIBLE("_qpr0txbfy")
		ACTIVATE WINDOW _qpr0txbfy SAME
	ELSE
		ACTIVATE WINDOW _qpr0txbfy NOSHOW
	ENDIF
	@ 3.500,1.833 SAY "In Field:" ;
		FONT "Geneva", 10
	@ 1.333,11.500 GET m.srchterm ;
		SIZE 1.000,26.333 ;
		DEFAULT " " ;
		FONT "Geneva", 10 ;
		PICTURE "@3S60" ;
		WHEN _qpr0txbxp()
	@ 3.250,11.167 GET fldnum ;
		PICTURE "@^3" ;
		FROM fldarry ;
		SIZE 1.500,27.000 ;
		DEFAULT 1 ;
		FONT "Geneva", 10 ;
		VALID _qpr0txc0s()
	@ 1.333,42.333 GET oksrch ;
		PICTURE "@*VN3 \!OK;\?Cancel" ;
		SIZE 1.500,10.000,0.500 ;
		DEFAULT 1 ;
		FONT "Geneva", 10 ;
		STYLE "B" ;
		VALID _qpr0txc4u()
	@ 1.250,1.833 SAY "Find:" ;
		FONT "Geneva", 10 ;
		STYLE "T" ;
		COLOR RGB(0,0,0,255,255,255)
	
	IF NOT WVISIBLE("_qpr0txbfy")
		ACTIVATE WINDOW _qpr0txbfy
	ENDIF
	
	
	*       *********************************************************
	*       *                                                         
	*       *   MacintoshREAD contains clauses from SCREEN appsrch    
	*       *                                                         
	*       *********************************************************
	*
	
	READ CYCLE ;
		ACTIVATE _qpr0txci1() ;
		DEACTIVATE _qpr0txci5() ;
		MODAL
	
	RELEASE WINDOW _qpr0txbfy
	
	#REGION 0
	
	SET READBORDER &rborder
	
	IF m.talkstat = "ON"
		SET TALK ON
	ENDIF
	IF m.compstat = "ON"
		SET COMPATIBLE ON
	ENDIF
	
	
	*       *********************************************************
	*       *                                                         
	*       *             APPSRCH/Macintosh Cleanup Code              
	*       *                                                         
	*       *********************************************************
	*
	
	#REGION 1
	IF m.curs_stat
	   SET CURSOR ON
	ELSE
	   SET CURSOR OFF
	ENDIF
	m.skipvar = .F.
	

CASE _WINDOWS

	
	#REGION 0
	REGIONAL m.currarea, m.talkstat, m.compstat
	
	IF SET("TALK") = "ON"
		SET TALK OFF
		m.talkstat = "ON"
	ELSE
		m.talkstat = "OFF"
	ENDIF
	m.compstat = SET("COMPATIBLE")
	SET COMPATIBLE FOXPLUS
	
	m.rborder = SET("READBORDER")
	SET READBORDER ON
	
	*       *********************************************************
	*       *                                                         
	*       *               Windows Window definitions                
	*       *                                                         
	*       *********************************************************
	*
	
	IF NOT WEXIST("_qpr0txctx")
		DEFINE WINDOW _qpr0txctx ;
			AT  0.000, 0.000  ;
			SIZE 6.462,61.833 ;
			TITLE " Buscar " ;
			FONT "MS Sans Serif", 8 ;
			STYLE "B" ;
			FLOAT ;
			NOCLOSE ;
			SHADOW ;
			NOMINIMIZE ;
			DOUBLE ;
			COLOR RGB(,,,192,192,192)
		MOVE WINDOW _qpr0txctx CENTER
	ENDIF
	
	
	*       *********************************************************
	*       *                                                         
	*       *         APPSRCH/Windows Setup Code - SECTION 2          
	*       *                                                         
	*       *********************************************************
	*
	
	#REGION 1
	IF TYPE("srchterm") $ "UL" OR EMPTY(m.srchterm)
	   m.srchterm = SPACE(60)
	ENDIF
	m.oksrch = 1
	m.fldnum = 0
	
	DIMENSION fldarry(10,4)   && default dimensions.  AFIELDS will reset if necessary.
	m.fldcnt = AFIELDS(fldarry)
	m.startord = ORDER()
	m.startalias = ALIAS()
	
	m.curord = ORDER()
	IF EMPTY(m.curord)
	   SET ORDER TO 1
	   m.curord = ORDER()
	ENDIF
	
	FOR i = 1 TO FCOUNT()
	   IF FIELDS(i) == m.curord
	      m.fldnum = i
	   ENDIF
	ENDFOR
	
	IF m.fldnum > 0
	   m.fldname = FIELDS(m.fldnum)
	ELSE
	   SET ORDER TO 1
	   m.fldnum  = 1
	   m.fldname = FIELDS(1)
	ENDIF
	
	skipvar = .T.
	
	curs_stat = (UPPER(SET("CURSOR")) = "ON")
	SET CURSOR ON
	
	
	*       *********************************************************
	*       *                                                         
	*       *              APPSRCH/Windows Screen Layout              
	*       *                                                         
	*       *********************************************************
	*
	
	#REGION 1
	IF WVISIBLE("_qpr0txctx")
		ACTIVATE WINDOW _qpr0txctx SAME
	ELSE
		ACTIVATE WINDOW _qpr0txctx NOSHOW
	ENDIF
	@ 4.231,1.833 SAY "En el campo:" ;
		FONT "MS Sans Serif", 8 ;
		STYLE "B"
	@ 1.231,16.500 GET m.srchterm ;
		SIZE 1.000,26.333 ;
		DEFAULT " " ;
		FONT "MS Sans Serif", 8 ;
		STYLE "B" ;
		PICTURE "@3S60" ;
		WHEN _qpr0txdc2()
	@ 3.846,16.167 GET fldnum ;
		PICTURE "@^" ;
		FROM fldarry ;
		SIZE 1.538,27.000 ;
		DEFAULT 1 ;
		FONT "MS Sans Serif", 8 ;
		VALID _qpr0txdf0()
	@ 1.154,47.333 GET oksrch ;
		PICTURE "@*VN \!\<Aceptar;\?\<Cancelar" ;
		SIZE 1.846,10.000,0.538 ;
		DEFAULT 1 ;
		FONT "MS Sans Serif", 8 ;
		STYLE "B" ;
		VALID _qpr0txdjd()
	@ 1.231,1.833 SAY "Buscar:" ;
		FONT "MS Sans Serif", 8 ;
		STYLE "BT" ;
		COLOR RGB(0,0,0,255,255,255)
	
	IF NOT WVISIBLE("_qpr0txctx")
		ACTIVATE WINDOW _qpr0txctx
	ENDIF
	
	
	*       *********************************************************
	*       *                                                         
	*       *    WindowsREAD contains clauses from SCREEN appsrch     
	*       *                                                         
	*       *********************************************************
	*
	
	READ CYCLE ;
		ACTIVATE _qpr0txdw9() ;
		DEACTIVATE _qpr0txdwc() ;
		MODAL
	
	RELEASE WINDOW _qpr0txctx
	
	#REGION 0
	
	SET READBORDER &rborder
	
	IF m.talkstat = "ON"
		SET TALK ON
	ENDIF
	IF m.compstat = "ON"
		SET COMPATIBLE ON
	ENDIF
	
	
	*       *********************************************************
	*       *                                                         
	*       *              APPSRCH/Windows Cleanup Code               
	*       *                                                         
	*       *********************************************************
	*
	
	#REGION 1
	IF m.curs_stat
	   SET CURSOR ON
	ELSE
	   SET CURSOR OFF
	ENDIF
	m.skipvar = .F.
	

ENDCASE


*       *********************************************************
*       *                                                         
*       * _QPR0TXAJV           m.srchterm WHEN                    
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       MS-DOS                             
*       * From Screen:         APPSRCH,     Record Number:    2   
*       * Variable:            m.srchterm                         
*       * Called By:           WHEN Clause                        
*       * Object Type:         Field                              
*       * Snippet Number:      1                                  
*       *                                                         
*       *********************************************************
*
FUNCTION _qpr0txajv     &&  m.srchterm WHEN
#REGION 1
m.srchterm = PADR(m.srchterm,60)
SHOW GETS


*       *********************************************************
*       *                                                         
*       * _QPR0TXAMV           fldnum VALID                       
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       MS-DOS                             
*       * From Screen:         APPSRCH,     Record Number:    3   
*       * Variable:            fldnum                             
*       * Called By:           VALID Clause                       
*       * Object Type:         Popup                              
*       * Snippet Number:      2                                  
*       *                                                         
*       *********************************************************
*
FUNCTION _qpr0txamv     &&  fldnum VALID
#REGION 1
m.fldname = FIELDS(m.fldnum)
tagnum = gettag(m.fldname)     && tag number of tag with name fldname

IF tagnum > 0
   SET ORDER TO TAG(m.tagnum)
ELSE
   SET ORDER TO 0
ENDIF
SHOW GETS


*       *********************************************************
*       *                                                         
*       * _QPR0TXAQR           oksrch VALID                       
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       MS-DOS                             
*       * From Screen:         APPSRCH,     Record Number:    4   
*       * Variable:            oksrch                             
*       * Called By:           VALID Clause                       
*       * Object Type:         Push Button                        
*       * Snippet Number:      3                                  
*       *                                                         
*       *********************************************************
*
FUNCTION _qpr0txaqr     &&  oksrch VALID
#REGION 1
skipvar = .F.
IF m.oksrch = 1 AND !EMPTY(m.srchterm)
   m.srchterm = ALLTRIM(m.srchterm)
   WAIT CLEAR

   m.tagnum = gettag(m.fldname)
   IF m.tagnum > 0
      SET ORDER TO TAG(m.tagnum)
   ELSE
      DO waitmsg   && warn user that this may take a while
   ENDIF
   m.thisrec = RECNO()
   DO CASE
   CASE TYPE("&fldname") $ "CM"     && character or memo field
      IF m.tagnum > 0
         SEEK ALLTRIM(m.srchterm)
         IF !FOUND()
            IF m.thisrec <= RECCOUNT() AND m.thisrec > 0
               GOTO m.thisrec
            ENDIF
            answer = .F.
            DO doloc WITH m.srchterm, m.answer   && prompt for locate

            IF m.answer = .T.
               DO waitmsg
               GOTO TOP
               LOCATE FOR UPPER(m.srchterm) $ UPPER(&fldname)
            ENDIF
         ENDIF
      ELSE
         LOCATE FOR UPPER(m.srchterm) $ UPPER(&fldname)
      ENDIF
   CASE TYPE("&fldname") $ "FN"     && floating or numeric
      m.srchterm = CHRTRAN(m.srchterm,'"','')
      m.srchterm = CHRTRAN(m.srchterm,"'","")
      LOCATE FOR VAL(ALLTRIM(m.srchterm)) = &fldname
   CASE TYPE("&fldname") = "D"      && date
      m.srchterm = CHRTRAN(m.srchterm,'{}"()','')
      m.srchterm = CHRTRAN(m.srchterm,"'",'')
      m.srchterm = ALLTRIM(m.srchterm)
      LOCATE FOR CTOD(srchterm) = &fldname
   CASE TYPE("&fldname") = "L"      && logical
      IF "T" $ UPPER(m.srchterm)
         LOCATE FOR &fldname
      ELSE
         LOCATE FOR !&fldname
      ENDIF
   CASE TYPE("&fldname") = "U"      && unknown field type--should't happen
      WAIT WINDOW "El campo "+m.fldname+" no se ha encontrado"
   ENDCASE
   IF !FOUND()
      SET CURSOR OFF
      WAIT WINDOW "No se encuentra" NOWAIT
      IF m.thisrec <= RECCOUNT() AND m.thisrec > 0
         GOTO m.thisrec
      ENDIF
   ELSE
      SET CURSOR OFF
      WAIT WINDOW "Buscar" NOWAIT
      CLEAR READ
   ENDIF
ELSE
   SET ORDER TO (m.startord)
   CLEAR READ
ENDIF


*       *********************************************************
*       *                                                         
*       * _QPR0TXB41           Read Level Activate                
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       *                                                         
*       * From Platform:       MS-DOS                             
*       * From Screen:         APPSRCH                            
*       * Called By:           READ Statement                     
*       * Snippet Number:      4                                  
*       *                                                         
*       *********************************************************
*
FUNCTION _qpr0txb41     && Read Level Activate
*
* Activate Code from screen: APPSRCH
*
#REGION 1
SELECT (m.startalias)


*       *********************************************************
*       *                                                         
*       * _QPR0TXB45           Read Level Deactivate              
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       *                                                         
*       * From Platform:       MS-DOS                             
*       * From Screen:         APPSRCH                            
*       * Called By:           READ Statement                     
*       * Snippet Number:      5                                  
*       *                                                         
*       *********************************************************
*
FUNCTION _qpr0txb45     && Read Level Deactivate
*
* Deactivate Code from screen: APPSRCH
*
#REGION 1
?? CHR(7)
RETURN .F.


*       *********************************************************
*       *                                                         
*       * _QPR0TXBXP           m.srchterm WHEN                    
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       Macintosh                          
*       * From Screen:         APPSRCH,     Record Number:   17   
*       * Variable:            m.srchterm                         
*       * Called By:           WHEN Clause                        
*       * Object Type:         Field                              
*       * Snippet Number:      6                                  
*       *                                                         
*       *********************************************************
*
FUNCTION _qpr0txbxp     &&  m.srchterm WHEN
#REGION 1
m.srchterm = PADR(m.srchterm,60)
SHOW GETS


*       *********************************************************
*       *                                                         
*       * _QPR0TXC0S           fldnum VALID                       
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       Macintosh                          
*       * From Screen:         APPSRCH,     Record Number:   18   
*       * Variable:            fldnum                             
*       * Called By:           VALID Clause                       
*       * Object Type:         Popup                              
*       * Snippet Number:      7                                  
*       *                                                         
*       *********************************************************
*
FUNCTION _qpr0txc0s     &&  fldnum VALID
#REGION 1
m.fldname = FIELDS(m.fldnum)
tagnum = gettag(m.fldname)     && tag number of tag with name fldname

IF tagnum > 0
   SET ORDER TO TAG(m.tagnum)
ELSE
   SET ORDER TO 0
ENDIF
SHOW GETS


*       *********************************************************
*       *                                                         
*       * _QPR0TXC4U           oksrch VALID                       
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       Macintosh                          
*       * From Screen:         APPSRCH,     Record Number:   19   
*       * Variable:            oksrch                             
*       * Called By:           VALID Clause                       
*       * Object Type:         Push Button                        
*       * Snippet Number:      8                                  
*       *                                                         
*       *********************************************************
*
FUNCTION _qpr0txc4u     &&  oksrch VALID
#REGION 1
skipvar = .F.
IF m.oksrch = 1 AND !EMPTY(m.srchterm)
   m.srchterm = ALLTRIM(m.srchterm)
   WAIT CLEAR

   m.tagnum = gettag(m.fldname)
   IF m.tagnum > 0
      SET ORDER TO TAG(m.tagnum)
   ELSE
      DO waitmsg   && warn user that this may take a while
   ENDIF
   m.thisrec = RECNO()
   DO CASE
   CASE TYPE("&fldname") $ "CM"     && character or memo field
      IF m.tagnum > 0
         SEEK ALLTRIM(m.srchterm)
         IF !FOUND()
            IF m.thisrec <= RECCOUNT() AND m.thisrec > 0
               GOTO m.thisrec
            ENDIF
            answer = .F.
            DO doloc WITH m.srchterm, m.answer   && prompt for locate

            IF m.answer = .T.
               DO waitmsg
               GOTO TOP
               LOCATE FOR UPPER(m.srchterm) $ UPPER(&fldname)
            ENDIF
         ENDIF
      ELSE
         LOCATE FOR UPPER(m.srchterm) $ UPPER(&fldname)
      ENDIF
   CASE TYPE("&fldname") $ "FN"     && floating or numeric
      m.srchterm = CHRTRAN(m.srchterm,'"','')
      m.srchterm = CHRTRAN(m.srchterm,"'","")
      LOCATE FOR VAL(ALLTRIM(m.srchterm)) = &fldname
   CASE TYPE("&fldname") = "D"      && date
      m.srchterm = CHRTRAN(m.srchterm,'{}"()','')
      m.srchterm = CHRTRAN(m.srchterm,"'",'')
      m.srchterm = ALLTRIM(m.srchterm)
      LOCATE FOR CTOD(srchterm) = &fldname
   CASE TYPE("&fldname") = "L"      && logical
      IF "T" $ UPPER(m.srchterm)
         LOCATE FOR &fldname
      ELSE
         LOCATE FOR !&fldname
      ENDIF
   CASE TYPE("&fldname") = "U"      && unknown field type--should't happen
      WAIT WINDOW "Field "+m.fldname+" not found"
   ENDCASE
   IF !FOUND()
      SET CURSOR OFF
      WAIT WINDOW "Not found" NOWAIT
      IF m.thisrec <= RECCOUNT() AND m.thisrec > 0
         GOTO m.thisrec
      ENDIF
   ELSE
      SET CURSOR OFF
      WAIT WINDOW "Found it!" NOWAIT
      CLEAR READ
   ENDIF
ELSE
   SET ORDER TO (m.startord)
   CLEAR READ
ENDIF


*       *********************************************************
*       *                                                         
*       * _QPR0TXCI1           Read Level Activate                
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       *                                                         
*       * From Platform:       Macintosh                          
*       * From Screen:         APPSRCH                            
*       * Called By:           READ Statement                     
*       * Snippet Number:      9                                  
*       *                                                         
*       *********************************************************
*
FUNCTION _qpr0txci1     && Read Level Activate
*
* Activate Code from screen: APPSRCH
*
#REGION 1
SELECT (m.startalias)


*       *********************************************************
*       *                                                         
*       * _QPR0TXCI5           Read Level Deactivate              
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       *                                                         
*       * From Platform:       Macintosh                          
*       * From Screen:         APPSRCH                            
*       * Called By:           READ Statement                     
*       * Snippet Number:      10                                 
*       *                                                         
*       *********************************************************
*
FUNCTION _qpr0txci5     && Read Level Deactivate
*
* Deactivate Code from screen: APPSRCH
*
#REGION 1
?? CHR(7)
RETURN .F.


*       *********************************************************
*       *                                                         
*       * _QPR0TXDC2           m.srchterm WHEN                    
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       Windows                            
*       * From Screen:         APPSRCH,     Record Number:    9   
*       * Variable:            m.srchterm                         
*       * Called By:           WHEN Clause                        
*       * Object Type:         Field                              
*       * Snippet Number:      11                                 
*       *                                                         
*       *********************************************************
*
FUNCTION _qpr0txdc2     &&  m.srchterm WHEN
#REGION 1
m.srchterm = PADR(m.srchterm,60)
SHOW GETS


*       *********************************************************
*       *                                                         
*       * _QPR0TXDF0           fldnum VALID                       
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       Windows                            
*       * From Screen:         APPSRCH,     Record Number:   10   
*       * Variable:            fldnum                             
*       * Called By:           VALID Clause                       
*       * Object Type:         Popup                              
*       * Snippet Number:      12                                 
*       *                                                         
*       *********************************************************
*
FUNCTION _qpr0txdf0     &&  fldnum VALID
#REGION 1
m.fldname = FIELDS(m.fldnum)
tagnum = gettag(m.fldname)     && tag number of tag with name fldname

IF tagnum > 0
   SET ORDER TO TAG(m.tagnum)
ELSE
   SET ORDER TO 0
ENDIF
SHOW GETS


*       *********************************************************
*       *                                                         
*       * _QPR0TXDJD           oksrch VALID                       
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       * From Platform:       Windows                            
*       * From Screen:         APPSRCH,     Record Number:   11   
*       * Variable:            oksrch                             
*       * Called By:           VALID Clause                       
*       * Object Type:         Push Button                        
*       * Snippet Number:      13                                 
*       *                                                         
*       *********************************************************
*
FUNCTION _qpr0txdjd     &&  oksrch VALID
#REGION 1
skipvar = .F.
IF m.oksrch = 1 AND !EMPTY(m.srchterm)
   m.srchterm = ALLTRIM(m.srchterm)
   WAIT CLEAR

   m.tagnum = gettag(m.fldname)
   IF m.tagnum > 0
      SET ORDER TO TAG(m.tagnum)
   ELSE
      DO waitmsg   && warn user that this may take a while
   ENDIF
   m.thisrec = RECNO()
   DO CASE
   CASE TYPE("&fldname") $ "CM"     && character or memo field
      IF m.tagnum > 0
         SEEK ALLTRIM(m.srchterm)
         IF !FOUND()
            IF m.thisrec <= RECCOUNT() AND m.thisrec > 0
               GOTO m.thisrec
            ENDIF
            answer = .F.
            DO doloc WITH m.srchterm, m.answer   && prompt for locate

            IF m.answer = .T.
               DO waitmsg
               GOTO TOP
               LOCATE FOR UPPER(m.srchterm) $ UPPER(&fldname)
            ENDIF
         ENDIF
      ELSE
         LOCATE FOR UPPER(m.srchterm) $ UPPER(&fldname)
      ENDIF
   CASE TYPE("&fldname") $ "FN"     && floating or numeric
      m.srchterm = CHRTRAN(m.srchterm,'"','')
      m.srchterm = CHRTRAN(m.srchterm,"'","")
      LOCATE FOR VAL(ALLTRIM(m.srchterm)) = &fldname
   CASE TYPE("&fldname") = "D"      && date
      m.srchterm = CHRTRAN(m.srchterm,'{}"()','')
      m.srchterm = CHRTRAN(m.srchterm,"'",'')
      m.srchterm = ALLTRIM(m.srchterm)
      LOCATE FOR CTOD(srchterm) = &fldname
   CASE TYPE("&fldname") = "L"      && logical
      IF "T" $ UPPER(m.srchterm)
         LOCATE FOR &fldname
      ELSE
         LOCATE FOR !&fldname
      ENDIF
   CASE TYPE("&fldname") = "U"      && unknown field type--should't happen
      WAIT WINDOW "Campo "+m.fldname+" no se encuentra"
   ENDCASE
   IF !FOUND()
      SET CURSOR OFF
      WAIT WINDOW "No se encuentra" NOWAIT
      IF m.thisrec <= RECCOUNT() AND m.thisrec > 0
         GOTO m.thisrec
      ENDIF
   ELSE
      SET CURSOR OFF
      WAIT WINDOW "Buscar" NOWAIT
      CLEAR READ
   ENDIF
ELSE
   SET ORDER TO (m.startord)
   CLEAR READ
ENDIF


*       *********************************************************
*       *                                                         
*       * _QPR0TXDW9           Read Level Activate                
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       *                                                         
*       * From Platform:       Windows                            
*       * From Screen:         APPSRCH                            
*       * Called By:           READ Statement                     
*       * Snippet Number:      14                                 
*       *                                                         
*       *********************************************************
*
FUNCTION _qpr0txdw9     && Read Level Activate
*
* Activate Code from screen: APPSRCH
*
#REGION 1
SELECT (m.startalias)


*       *********************************************************
*       *                                                         
*       * _QPR0TXDWC           Read Level Deactivate              
*       *                                                         
*       * Function Origin:                                        
*       *                                                         
*       *                                                         
*       * From Platform:       Windows                            
*       * From Screen:         APPSRCH                            
*       * Called By:           READ Statement                     
*       * Snippet Number:      15                                 
*       *                                                         
*       *********************************************************
*
FUNCTION _qpr0txdwc     && Read Level Deactivate
*
* Deactivate Code from screen: APPSRCH
*
#REGION 1
?? CHR(7)
RETURN .F.



*       *********************************************************
*       *                                                         
*       *  APPSRCH/Windows Supporting Procedures and Functions    
*       *                                                         
*       *********************************************************
*

#REGION 1

*       *********************************************************
*       *                                                         
*       *                 APPSRCH Function GETTAG                 
*       *                                                         
*       *********************************************************
*


PROCEDURE GETTAG
PARAMETERS FLDNAME
DO CASE
CASE _DOS
	*) Returns tag number corresponding to field "fldname", or 0 if there
	*) is not tag with the same name as "fldname."
	PRIVATE ALL
	m.fldname = UPPER(ALLTRIM(m.fldname))
	m.i = 1
	DO WHILE !EMPTY(TAG(m.i)) AND m.i < 1000
	   IF UPPER(TAG(m.i)) == m.fldname
	      RETURN m.i
	   ENDIF
	   m.i = m.i + 1
	ENDDO
	RETURN 0
	
	
	*!*****************************************************************
	*!
	*!      Procedure: WAITMSG
	*!
	*!*****************************************************************
CASE _WINDOWS
	*) Returns tag number corresponding to field "fldname", or 0 if there
	*) is not tag with the same name as "fldname."
	PRIVATE ALL
	m.fldname = UPPER(ALLTRIM(m.fldname))
	m.i = 1
	DO WHILE !EMPTY(TAG(m.i)) AND m.i < 1000
	   IF UPPER(TAG(m.i)) == m.fldname
	      RETURN m.i
	   ENDIF
	   m.i = m.i + 1
	ENDDO
	RETURN 0
	
	
	*!*****************************************************************
	*!
	*!      Procedure: WAITMSG
	*!
	*!*****************************************************************
CASE _MAC
	*) Returns tag number corresponding to field "fldname", or 0 if there
	*) is not tag with the same name as "fldname."
	PRIVATE ALL
	m.fldname = UPPER(ALLTRIM(m.fldname))
	m.i = 1
	DO WHILE !EMPTY(TAG(m.i)) AND m.i < 1000
	   IF UPPER(TAG(m.i)) == m.fldname
	      RETURN m.i
	   ENDIF
	   m.i = m.i + 1
	ENDDO
	RETURN 0
	
	
	*!*****************************************************************
	*!
	*!      Procedure: WAITMSG
	*!
	*!*****************************************************************
ENDCASE

*       *********************************************************
*       *                                                         
*       *                APPSRCH Procedure WAITMSG                
*       *                                                         
*       *********************************************************
*


PROCEDURE WAITMSG
DO CASE
CASE _DOS
	IF RECCOUNT() > 1000
	   WAIT WINDOW "Buscando... Espere, por favor." NOWAIT
	ELSE
	   WAIT WINDOW "Buscando" NOWAIT
	ENDIF
	
	
	
	*!*****************************************************************
	*!
	*!      Procedure: DOLOC
	*!
	*!*****************************************************************
CASE _WINDOWS
	IF RECCOUNT() > 1000
	   WAIT WINDOW "Buscando. Puede que tarde unos momentos." NOWAIT
	ELSE
	   WAIT WINDOW "Buscando" NOWAIT
	ENDIF
	
	
	
	*!*****************************************************************
	*!
	*!      Procedure: DOLOC
	*!
	*!*****************************************************************
CASE _MAC
	IF RECCOUNT() > 1000
	   WAIT WINDOW "Searching.  This may take a few moments." NOWAIT
	ELSE
	   WAIT WINDOW "Searching" NOWAIT
	ENDIF
	
	
	
	*!*****************************************************************
	*!
	*!      Procedure: DOLOC
	*!
	*!*****************************************************************
ENDCASE

*       *********************************************************
*       *                                                         
*       *                 APPSRCH Procedure DOLOC                 
*       *                                                         
*       *********************************************************
*


PROCEDURE DOLOC
PARAMETERS TERM, ANSWER
DO CASE
CASE _DOS
	* See if the user wants to do a long substring search
	
	IF NOT WEXIST("doloc")
		IF _MAC
	  	 DEFINE WINDOW doloc ;
	      FROM INT((srow()-9)/2),INT((scol()-63)/2) ;
	      TO INT((srow()-9)/2)+9,INT((scol()-63)/2)+61 ;
	      TITLE "Opciones de b£squeda" ;
	      FLOAT ;
	      NOCLOSE ;
	      SHADOW ;
	      DOUBLE
		ELSE
	  	 DEFINE WINDOW doloc ;
	      FROM INT((srow()-9)/2),INT((scol()-63)/2) ;
	      TO INT((srow()-9)/2)+9,INT((scol()-63)/2)+61 ;
	      TITLE "Opciones de b£squeda" ;
	      FLOAT ;
	      NOCLOSE ;
	      SHADOW ;
	      DOUBLE ;
	      COLOR SCHEME 5
	   ENDIF
	ENDIF
	
	answer = .F.
	ACTIVATE WINDOW doloc NOSHOW
	
	@ 6,16 GET locok ;
	   PICTURE "@*HT \!\<Buscar;\?\<Cancelar" ;
	   SIZE 1.769,12.0,4.0 ;
	   DEFAULT 1
	@ 1,1 SAY "No se ha podido encontrar con m‚todos r pidos ning£n"
	@ 2,1 SAY "registro que cumpla sus condiciones. ¨Desea buscar"
	@ 3,1 SAY "de nuevo usando m‚todos m s lentos y exhaustivos?"
	
	IF NOT WVISIBLE("doloc")
	   ACTIVATE WINDOW doloc
	ENDIF
	
	READ CYCLE MODAL
	
	RELEASE WINDOW doloc
	answer = (locok = 1)
	
CASE _WINDOWS
	* See if the user wants to do a long substring search
	
	IF NOT WEXIST("doloc")
		IF _MAC
	  	 DEFINE WINDOW doloc ;
	      FROM INT((srow()-9)/2),INT((scol()-63)/2) ;
	      TO INT((srow()-9)/2)+9,INT((scol()-63)/2)+61 ;
	      TITLE "Opciones de b£squeda" ;
	      FLOAT ;
	      NOCLOSE ;
	      SHADOW ;
	      DOUBLE
		ELSE
	  	 DEFINE WINDOW doloc ;
	      FROM INT((srow()-9)/2),INT((scol()-63)/2) ;
	      TO INT((srow()-9)/2)+9,INT((scol()-63)/2)+61 ;
	      TITLE "Opciones de b£squeda" ;
	      FLOAT ;
	      NOCLOSE ;
	      SHADOW ;
	      DOUBLE ;
	      COLOR SCHEME 5
	   ENDIF
	ENDIF
	
	answer = .F.
	ACTIVATE WINDOW doloc NOSHOW
	
	@ 6,16 GET locok ;
	   PICTURE "@*HT \!\<Buscar;\?\<Cancelar" ;
	   SIZE 1.769,12.0,4.0 ;
	   DEFAULT 1
	@ 1,1 SAY "FoxApp no encontr¢ registros que coincidieran usando"
	@ 2,1 SAY "el m‚todo r pido de b£squeda. ¨Desea buscar usando"
	@ 3,1 SAY "m‚todos m s lentos pero m s exhaustivos?"
	
	IF NOT WVISIBLE("doloc")
	   ACTIVATE WINDOW doloc
	ENDIF
	
	READ CYCLE MODAL
	
	RELEASE WINDOW doloc
	answer = (locok = 1)
	
CASE _MAC
	* See if the user wants to do a long substring search
	
	IF NOT WEXIST("doloc")
		IF _MAC
	  	 DEFINE WINDOW doloc ;
	      FROM INT((srow()-9)/2),INT((scol()-63)/2) ;
	      TO INT((srow()-9)/2)+9,INT((scol()-63)/2)+61 ;
	      TITLE "Searching Options" ;
	      FLOAT ;
	      NOCLOSE ;
	      SHADOW ;
	      DOUBLE
		ELSE
	  	 DEFINE WINDOW doloc ;
	      FROM INT((srow()-9)/2),INT((scol()-63)/2) ;
	      TO INT((srow()-9)/2)+9,INT((scol()-63)/2)+61 ;
	      TITLE "Searching Options" ;
	      FLOAT ;
	      NOCLOSE ;
	      SHADOW ;
	      DOUBLE ;
	      COLOR SCHEME 5
	   ENDIF
	ENDIF
	
	answer = .F.
	ACTIVATE WINDOW doloc NOSHOW
	
	@ 6,16 GET locok ;
	   PICTURE "@*HT \!\<Search;\?\<Cancel" ;
	   SIZE 1.769,12.0,4.0 ;
	   DEFAULT 1
	@ 1,1 SAY "FoxApp was not able to find a record matching your search"
	@ 2,1 SAY "term while using a fast searching method.  Do you want to"
	@ 3,1 SAY "search for the term with slower but more thorough methods?"
	
	IF NOT WVISIBLE("doloc")
	   ACTIVATE WINDOW doloc
	ENDIF
	
	READ CYCLE MODAL
	
	RELEASE WINDOW doloc
	answer = (locok = 1)
	
ENDCASE