CLEAR
SET KEY 377 TO GRABACODIGO   // ACIONA GRABACODIGO CON ALT 2

IF .NOT. SENHA(10,10)
 QUIT
ENDIF
IF CONFIRMA("CONTINUAR LA EJECUCION DEL PROGRAMA? (S/N)")=2
 MENSAJE(10,10,"PROGRAMA INTERRUMPIDO POR EL OPERADOR",3)
 QUIT
ENDIF

SELE 3
USE SECTORES INDEX INDSET
SELE 2
USE CARGOS INDEX CODCAR
SELE 1
USE FUNC index indcod

BOXa=CHR(201)+CHR(205)+CHR(187)+CHR(186)+;
     CHR(188)+CHR(205)+CHR(200)+CHR(186)+CHR(176)
DO WHILE .T.
CLEAR
@ 1,1,24,79 box boxa
NOME1=SPACE(30)
SET= SPACE(1)
CAR=SPACE(1)
sal=0
MCOD="   "
OBS=SPACE(10)
@ 10,10 say "codigo : " geT MCOD  ;
   VALID PESQUISA("FUNC",MCOD,"CODFUNC","NOMEFUNC")
READ
IF LASTKEY()=27
 EXIT
ENDIF
@ 12,10 SAY "CARGO  : " GET CAR PICT "@!" ;
   VALID PESQUISA("CARGOS",CAR,"CODCAR","NOMECAR")
READ
@ 13,10 SAY "SECTOR  : " GET SET PICT "@!" ;
   VALID PESQUISA("SECTORES",SET,"CODSET","NOMESET")
READ
EST=SPACE(2)
@ 04,10 SAY " ESTADO: " GET EST VALID COMPRUEBAEST(EST,ROW(),COL()+5)
READ
EST=SPACE(2)
NOMEEST=SPACE(20)
@ 06,10 SAY " ESTADO: " GET EST VALID COMPRUEBAEST(EST,,,@NOMEEST)
READ
@ 07,10 SAY NOMEEST
INKEY(0)
ENDDO
set cursor on
CLEAR
? "MOSTRANDO BELL1 "
BELL1()
INKEY(0)
BELL1(4)

? "MOSTRANDO BELL2"
? "CUANDO LA MUSICA O SECUENCIA ACABE PULSE INTRO"
BELL2(1)
INKEY(0)
BELL2(2)
INKEY(0)
BELL2(3)
INKEY(0)
BELL2(4)
INKEY(0)
BELL2(5)
INKEY(0)
BELL2(6)
INKEY(0)
BELL2(7)
INKEY(0)

*******************************************
FUNCTION SENHA
LIN=10 ; COL=10
IF COL>38
 COL=38
ENDIF
IF LIN>20
 LIN=20
ENDIF
TELASENHA:=SAVESCREEN(LIN-1,COL-1,LIN+3,COL+40)
@ LIN-1,COL-1 CLEAR TO LIN+3,COL+40
@ LIN-1,COL-1 TO       LIN+3,COL+40
ACESSO=1
DO WHILE .T.
      CODIGO=SPACE(3)
      @ LIN,COL SAY "OPERADOR.: " GET CODIGO
      READ
      IF UPPER(CODIGO)="FIN"
      RETURN(.F.)
      ENDIF
      num=0
      SET Conso OFF
      @ LIN,COL+18 SAY 'CONTRASE¥A: '
      WAIT TO Tw1
      TONE(100,1)
      @ LIN,COL() SAY '*'
      WAIT TO Tw2
      TONE(200,1)
      @ LIN,COL() SAY '*'
      WAIT TO Tw3
      TONE(300,1)
      @ LIN,COL() SAY '*'
      WAIT TO Tw4
      TONE(400,1)
      @ LIN,COL() SAY '*'
      WAIT TO Tw5
      TONE(500,1)
      @ LIN,COL() SAY '*'
      SET CONS ON
A=180
B=230
SENHA = CHR(VAL(Tw1)+A++)+CHR(VAL(Tw2)+B++)+CHR(VAL(Tw3)+A++)+;
        CHR(VAL(Tw4)+B++)+CHR(VAL(Tw5)+A++)
IF FILE("CONSEN.DBF")
  IF .NOT. FILE("OPERADOR.NTX")
   USE CONSEN
   INDEX ON CODOP TO OPERADOR
  ELSE
   USE CONSEN INDEX OPERADOR
  ENDIF
 ELSE
  @ LIN+2,COL SAY "ARCHIVO DE CONTROL DE ACCESO NO ENCONTRADO"
  INKEY(2)
  @ LIN+2,COL SAY SPACE(50)
  @ LIN+2,COL SAY "IMPOSIBLE ACCEDER AL SISTEMA"
  INKEY(2)
  CLEAR
  RETURN(.F.)
ENDIF
SEEK CODIGO
IF EOF()
  IF ACESSO <=3
   @ LIN+2,COL SAY "OPERADOR NO REGISTRADO. VUELVA A TECLEAR"
   INKEY(2)
   @ LIN+2,COL SAY SPACE(40)
   ACESSO++
   LOOP
  ELSE
   @ LIN+2,COL SAY "NUMERO DE INTENTOS MAYOR QUE TRES"
   INKEY(2)
   @ LIN+2,COL SAY SPACE(40)
   COR=SETCOLOR()
   SETCOLOR("W*/N")
   @ LIN+2,COL SAY "ACCESO DENEGADO..."
   INKEY(3)
   SETCOLOR("&COR")
   RESTSCREEN(LIN-1,COL-1,LIN+3,COL+40,TELASENHA)
   RETURN(.F.)
  ENDIF
ELSE
   IF CODSEN=SENHA
      COR=SETCOLOR()
      SETCOLOR("W*/N")
      @ LIN+2,COL SAY "CODIGO ACEPTADO..."
      INKEY(3)
      SETCOLOR("&COR")
      RESTSCREEN(LIN-1,COL-1,LIN+3,COL+40,TELASENHA)
     RETURN(.T.)
   ELSE
     IF ACESSO <=3
      @ LIN+2,COL SAY "CONTRASE¥A NO COMPATIBLE CON OPERADOR"
      INKEY(2)
      @ LIN+2, COL SAY "VUELVA A TECLEAR CODIGO DEL OPERADOR Y CONTRASE¥A"
      INKEY(2)
      @ LIN+2,COL SAY SPACE(40)
      ACESSO++
      LOOP
     ELSE
      @ LIN+2,COL SAY "NUMERO DE INTENTOS MAYOR QUE TRES"
      INKEY(2)
      @ LIN+2,COL SAY SPACE(40)
      COR=SETCOLOR()
      SETCOLOR("W*/N")
      @ LIN+2,COL SAY "ACCESO DENEGADO..."
      INKEY(3)
      SETCOLOR("&COR")
      RESTSCREEN(LIN-1,COL-1,LIN+3,COL+40,TELASENHA)
      RETURN(.F.)
     ENDIF
   ENDIF
ENDIF
ENDDO


PROCEDURE GRABACODIGO
LOCAL GETLIST:={} , LIN:=10 , COL:=10, CODIGO:=SPACE(3)
USE CONSEN  INDEX OPERADOR
TELASENHA:=SAVESCREEN(0,0,24,79)
@ LIN-1,COL-1 CLEAR TO LIN+3,COL+40
@ LIN-1,COL-1 TO       LIN+3,COL+40
DO WHILE .T.
 CODIGO=SPACE(3)
 @ LIN,COL SAY "OPERADOR.: " GET CODIGO
 READ
 IF UPPER(CODIGO)="FIM"
   EXIT
 ENDIF
 SEEK CODIGO
 IF .NOT. EOF()
      SET Conso OFF
      @ LIN,COL+20 SAY 'SENHA: '
      WAIT TO Tw1
      TONE(100,1)
      @ LIN,COL() SAY '*'
      WAIT TO Tw2
      TONE(300,1)
      @ LIN,COL() SAY '*'
      WAIT TO Tw3
      TONE(500,1)
      @ LIN,COL() SAY '*'
      WAIT TO Tw4
      TONE(700,1)
      @ LIN,COL() SAY '*'
      WAIT TO Tw5
      TONE(900,1)
      @ LIN,COL() SAY '*'
      SET CONS ON
 A=180
 B=230
 SENHA = CHR(VAL(Tw1)+A++)+CHR(VAL(Tw2)+B++)+CHR(VAL(Tw3)+A++)+;
        CHR(VAL(Tw4)+B++)+CHR(VAL(Tw5)+A++)
 REPLACE CODSEN WITH SENHA
ELSE
 @ LIN+2,COL SAY "OPERADOR NO REGISTRADO"
 INKEY(2)
 @ LIN+2,COL SAY SPACE(40)
 IF CONFIRMA("REGISTRAR EL CODIGO DE OPERADOR ?") =1
 APPEND BLANK
 REPLACE CODOP WITH CODIGO
 @ LIN+2,COL SAY "VUELVA A TECLEAR EL CODIGO E INDIQUE LA CONTRASE¥A"
 INKEY(2)
 @ LIN+2,COL SAY SPACE(40)
 LOOP
 ENDIF
ENDIF
ENDDO
RESTSCREEN(0,0,24,79,TELASENHA)


*************************************************
FUNCTION CONFIRMA(TEXTO)
local les,ces,largjan,telavelha
largjan=LEN(texto)+2
IF largjan<16
largjan=16
ENDIF 
ces=(80-largjan)/2
les=19
telavelha=SAVESCREEN(les,0,les+4,79)
corantig=SETCOLOR()
cornova="W/B,N/W"
SET COLOR TO &CORNOVA
@les,ces CLEAR TO les+3,ces+largjan
@les,ces TO les+3,ces+largjan double
@les+1,ces+2 SAY texto
coluna=(largjan-9)/2
@les+2,ces+coluna PROMPT "Si"
@les+2,ces+coluna+6 PROMPT "No"
MENU TO CONFIRM 
SET COLOR TO &CORANTIG
RESTSCREEN(les,0,les+4,79,telavelha)
RETURN (CONFIRM )


**************************************
FUNCTION MENSAJE(LS,cs,texto,tiempo)
LI=LS+1
CI=CS+LEN(TEXTO)
TELAMENS=SAVESCREEN(LS-1,CS-1,LI,CI)
@ls-1,cs-1 TO LI,CI DOUBLE
SET CURSOR OFF
@ls,cs SAY texto
IF tiempo<>NIL
 INKEY(tiempo)
ELSE
 INKEY(0)
ENDIF
SET CURSOR ON
RESTSCREEN(LS-1,CS-1,LI,CI,TELAMENS)
RETURN nil


****************************************************************
FUNCTION PESQUISA
PARAMETERS ARQBUSCA,CLAVE,CAMP1,CAMP2
DECLARE NCAMP[3]
NCAMP[1]=CAMP1
NCAMP[2]=CAMP2
J_ANTERIOR=SAVESCREEN(00,00,24,79)
ARQ_ATUAL=ALIAS()  &&PARA VOLVER AL AREA ACTUAL
SELECT &ARQBUSCA
SEEK CLAVE
IF FOUND()
   SELECT &ARQ_ATUAL
   RETURN(.T.)
 ELSE
   SAVE SCREEN TO PESQTELA
   @ 2,33 CLEAR TO 22,77
   MOLDURA(2,33,22,77," Selecione registro y pulse <intro> ")
   GOTO TOP
   DBEDIT(3,34,21,76,NCAMP,"TESTAPESQ")
   RETURN(.T.)
ENDIF



FUNCTION TESTAPESQ
PARAMETERS mode, counter
SET cursor ON
DO CASE
CASE mode=0
   IF DELETED()
      @ 23,70 SAY "BORRADO"
   ELSE
      @ 23,70 SAY REPLICATE(CHR(176),9)
   ENDIF
   RETURN (1)      && NO SE HICIERON CAMBIOS
CASE mode =1
   @ 23,55 SAY "INICIO DE ARCHIVO"  && Se puls¢ RE PAG o 
   INKEY(.5)                        && FLECHA ARRIBA en el registro 1.
   @ 23,55 SAY REPLICATE(CHR(176),20)
   RETURN (1)
CASE mode =2                        && Se puls¢ AV PAG o
   @ 23,55 SAY "FIN DE ARCHIVO"     && FLECHA ABAJO en el £ltimo
   INKEY(.5)                        && registro
   @ 23,55 SAY REPLICATE(CHR(176),20)
   RETURN (1)
CASE mode= 3
   @ 23,10 SAY "ARCHIVO VACIO"
   INKEY(1)
   RETURN (0)
******* comprueba la £ltima tecla pulsada
CASE LASTKEY()=27
    SELECT &ARQ_ATUAL
    RESTSCREEN(00,00,24,79,J_ANTERIOR)
    RETURN (0)
CASE LASTKEY()=13
   VARIAVEL=READVAR()
   &VARIAVEL=&CAMP1
   SELECT &ARQ_ATUAL
   RESTSCREEN(00,00,24,79,J_ANTERIOR)
   RETURN(0)
OTHERWISE
    SELECT &ARQ_ATUAL
    RESTSCREEN(00,00,24,79,J_ANTERIOR)
   RETURN (0)
ENDCASE

******************************************************
FUNCTION BELL1(VEZES)
IF VEZES =NIL
 VEZES=1
ENDIF
FOR I = 1 TO VEZES
 ?? CHR(7)
 INKEY(.2)
NEXT
RETURN NIL


*******************************************************
FUNCTION BELL2(TIPO)
IF TIPO=NIL
  TIPO=1
ENDIF
DO CASE
CASE TIPO=1    // FELICIDADES PARA USTED
     tone(262,3)
     tone(262,1)
     tone(294,6)
     tone(262,6)
     tone(349,6)
     tone(330,15)
CASE TIPO=2   // ATACAR
     TONE(392,1)
     TONE(523,1)
     TONE(659,1)
     TONE(784,5)
     TONE(659,1)
     TONE(784,25)
CASE TIPO=3    // MUSIQUILLA 
     TONE(262,2)
     TONE(262,2)
     TONE(392,2)
     TONE(392,2)
     TONE(440,2)
     TONE(440,2)
     TONE(392,6)
CASE TIPO=4     // HIMNO AMERICANO
      TONE(784,3)
      TONE(659,1)
      TONE(523,6)
      TONE(659,6)
      TONE(784,6)
      TONE(1047,15)
CASE TIPO=5     // MARCHA FUNEBRE
    TONE(261,8)
    TONE(261,7)
    TONE(261,2)
    TONE(261,8)
    TONE(311,7)
    TONE(293,2)
    TONE(293,7)
    TONE(261,2)
    TONE(261,7)
    TONE(247,2)
    TONE(261,8)
CASE TIPO=6   //ADVERTENCIA
  TONE(5000,5)
  TONE(4000,4)
  TONE(3000,3)
  TONE(2000,2)
CASE TIPO=7   // ERROR
   TONE(1000,2)
   TONE(500,3)
ENDCASE

**************************************************************
FUNCTION COMPRUEBAEST(VAR1,LIN,COL,VAR2)
ESTADOS:={{"AC","AL","AM","BA","CE","DF","ES",;
           "GO","MA","MG","MS","MT","PA","PB",;
           "PE","PI","PR","RJ","RN","RO","RR",;
           "RS","SC","SE","SP"},;
{"ACRE","ALAGOAS","AMAZONAS","BAHIA","CEARA",;
 "DISTRITO FEDERAL","ESPIRITO SANTO","GOIAS","MARANHAO",;
 "MINAS GERAIS","MATO GROSSO DO SUL","MATO GROSSO","PARA",;
 "PARAIBA","PERNANBUCO","PIAUI","PARANA","RIO DE JANEIRO",;
 "RIO GRANDE DO NORTE","RONDONIA","RORAIMA",;
 "RIO GRANDE DO SUL","SANTA CATARINA","SERGIPE","SAO PAULO"}}
ACHOU=ASCAN(ESTADOS[1],EST)
IF ACHOU>0
 IF VAR2<>NIL
  VAR2:=ESTADOS[2,ACHOU]
 ENDIF
 IF LIN <> NIL .OR. COL <> NIL
  @ LIN,COL SAY ESTADOS[2,ACHOU]
 ENDIF
 RETURN .T.
ELSE
 RETURN .F.
ENDIF

****************************************************
FUNCTION MOLDURA(LIN1,COL1,LIN2 ,COL2,TEXTO,DUPLO,ALTO)
IF PCOUNT()<5
RETURN (NIL)
ENDIF
IF DUPLO=NIL
 DUPLO=.F.
ENDIF
IF ALTO=NIL
 ALTO=.F.
ENDIF
IF duplo
 @LIN1,COL1 CLEAR TO LIN2 ,COL2
 @LIN1,COL1 TO LIN2 ,COL2 double
ELSE
 @LIN1,COL1 CLEAR TO LIN2 ,COL2
 @LIN1,COL1 TO LIN2 ,COL2
ENDIF
tam=COL2-COL1
novapos=(tam-LEN(texto))/2
IF ALTO
  @ LIN1,COL1+NOVAPOS SAY TEXTO
 ELSE
  @ LIN2,COL1+NOVAPOS SAY TEXTO
ENDIF
RETURN(NIL)